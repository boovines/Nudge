<div id="nudge-block"
  data-product-handle="{{ product.handle }}"
  data-currency="{{ shop.currency }}"
  data-discount-code="{{ block.settings.discount_code }}"
  data-discount-percent="{{ block.settings.discount_percent }}"
  data-preview="{{ block.settings.show_price_preview }}"
  data-override="{{ block.settings.override_theme_price }}"
  data-api-url="{{ block.settings.api_url | default: 'https://dimple-hystricomorphic-long.ngrok-free.dev' }}"
>
  <button
    id="nudge-cta"
    type="button"
    style="padding:10px 14px;border:1px solid #1f2937;border-radius:6px;background:#111;color:#fff;font-size:14px;cursor:pointer"
    onclick="window.NudgeChat && window.NudgeChat.open && window.NudgeChat.open()"
  >
    {{ block.settings.button_label }}
  </button>
</div>

<script src="{{ 'chatbot.js' | asset_url }}" defer></script>

{% schema %}
{
  "name": "Nudge Button",
  "target": "section",
  "settings": [
    { "type": "text", "id": "button_label", "label": "Button label", "default": "Chat with us" },
    { "type": "text", "id": "discount_code", "label": "Discount code", "default": "NUDGE10" },
    { "type": "range", "id": "discount_percent", "label": "Discount percent", "min": 1, "max": 90, "step": 1, "default": 10 },
    { "type": "checkbox", "id": "show_price_preview", "label": "Show discounted price preview", "default": true },
    { "type": "checkbox", "id": "override_theme_price", "label": "Replace visible theme price", "default": false },
    { "type": "text", "id": "api_url", "label": "API URL", "default": "https://dimple-hystricomorphic-long.ngrok-free.dev", "info": "Your ngrok URL or production server URL" }
  ]
}
{% endschema %}
